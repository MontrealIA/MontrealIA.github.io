<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
    <meta charset="utf-8">
<title>Montréal Artificial Intelligence - Montréal.AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">






<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="/MontrealAI.github.io/css/style.css">
<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/MontrealAI.github.io/">
                
                <img src="/MontrealAI.github.io/images/logo.png" alt="" height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item is-active"
               href="/MontrealAI.github.io/web-ai">WebAI</a>
            
            <a class="navbar-item "
               href="/MontrealAI.github.io/chiefaiofficers">Chief AI Officers</a>
            
            <a class="navbar-item "
               href="/MontrealAI.github.io/academy">Academy</a>
            
            <a class="navbar-item "
               href="/MontrealAI.github.io/about">LEGAL NOTICE</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            
            <a class="navbar-item" title="Twitter" href="https://twitter.com/Montreal_AI">
                
                <i class="fab fa-twitter"></i>
                
            </a>
               
            <a class="navbar-item" title="GitHub" href="https://github.com/MontrealAI">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            <a class="navbar-item" title="Facebook" href="https://www.facebook.com/MontrealAI/">
                
                <i class="fab fa-facebook"></i>
                
            </a>
               
            <a class="navbar-item" title="LinkedIn" href="https://www.linkedin.com/in/montrealai/">
                
                <i class="fab fa-linkedin"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Montréal Artificial Intelligence
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2018-07-28T21:43:04.000Z" itemprop="datePublished">Jul 28 2018</time>
        </span>
        
        
        <span class="column is-narrow">
            
            
            8 minutes read (About 1207 words)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <h2 id="WebAI-—-Artificial-Intelligence-for-the-Web"><a href="#WebAI-—-Artificial-Intelligence-for-the-Web" class="headerlink" title="WebAI — Artificial Intelligence for the Web"></a>WebAI — Artificial Intelligence for the Web</h2><p><strong>Deploying machine learning in the browser unlocks new possibilities</strong>, like interactive artificial intelligence! On a mobile device, the algorithm can even leverage sensor data (i.e.: gyroscope or accelerometer). Further, all data stays on the client, making TensorFlow.js useful for privacy preserving applications.</p>
<p><img src="../images/ai_web.jpg" alt="Montréal.AI Web — Artificial Intelligence for the Web" title="Montréal.AI Web : Deploying Machine Learning Models in the Browser"></p>
<h2 id="Three-workflows-with-TensorFlow-js"><a href="#Three-workflows-with-TensorFlow-js" class="headerlink" title="Three workflows with TensorFlow.js :"></a>Three workflows with TensorFlow.js :</h2><ul>
<li><p>Existing, pre-trained model can be imported for inference ;</p>
</li>
<li><p>Imported model can re-trained quickly (transfer learning) with only a small amount of data ; and</p>
</li>
<li><p>Models can be directly authored (define, train, and run) in the browser.</p>
</li>
</ul>
<p>There’s no need to install any libraries or drivers. Just open a webpage, and your program is ready to run. </p>
<p><img src="../images/TensorFlow_js_API.png" alt="An overview of TensorFlow.js APIs. TensorFlow.js is powered by WebGL and supports importing TensorFlow SavedModels and Keras models." title="An overview of TensorFlow.js APIs."></p>
<h2 id="How-Can-I-Order-an-AI-Agent"><a href="#How-Can-I-Order-an-AI-Agent" class="headerlink" title="How Can I Order an AI Agent ?"></a>How Can I Order an AI Agent ?</h2><script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"> </script>

<script>
const MathUtils = {
    lerp(a, b, t) {
        return a + t * (b - a);
    },
};

class Agent {
    constructor(
        brain = new NeuralNetwork(
            null,
            new NeuralNetworkLayer(2),
            new NeuralNetworkLayer(2),
            new NeuralNetworkLayer(1)
        ),
    ) {
        this.boundingBox = new Rectangle();
        this.brain = brain;
        this.isAlive = true;
        this.position = new Vector2();
        this.score = 0;
    }

    dispose() {
        this.brain.dispose();
    }

    kill() {
        this.isAlive = false;
    }

    render(context) {
        context.save();

        context.globalCompositeOperation = 'darken';
        context.fillStyle = this.isAlive
            ? '#ea2d2d'
            : '#dde1e4';

        context.fillRect(
            this.boundingBox.left,
            this.boundingBox.top,
            this.boundingBox.width,
            this.boundingBox.height);

        context.restore();
    }

    update(context, target) {
        const { width } = context.canvas;
        const sizeHalf = 0.5 * Agent.SIZE;

        const output = this.brain.predict([this.position.x, target])
            .dataSync();

        this.position.x += Agent.SPEED * output[0];
        this.position.x = Math.max(sizeHalf, Math.min(width - sizeHalf, this.position.x));

        this.updateBoundingBox();
    }

    updateBoundingBox() {
        const sizeHalf = 0.5 * Agent.SIZE;

        this.boundingBox.left = this.position.x - sizeHalf;
        this.boundingBox.right = this.position.x + sizeHalf;
        this.boundingBox.top = this.position.y - sizeHalf;
        this.boundingBox.bottom = this.position.y + sizeHalf;
    }

    static get SIZE() {
        return 8;
    }

    static get SPEED() {
        return 64;
    }

    static fromParents(a, b) {
        return new Agent(NeuralNetwork.fromParents(a.brain, b.brain));
    }
}

class NeuralNetwork {
    constructor(weights, ...layers) {
        this.inputLayerSize = layers[0].size;
        this.layers = layers;

        this.weights = weights || layers
            .slice(0, layers.length - 1)
            .map((layer, index) => {
                const layerSizeNext = layers[index + 1].size;

                return tf.randomUniform([layer.size, layerSizeNext], -1, 1);
            });
    }

    dispose() {
        this.weights
            .forEach(w => w.dispose());
    }

    getWeights() {
        return this.weights
            .map(weights => weights.dataSync());
    }

    predict(input) {
        return tf.tidy(() => {
            const inputLayer = tf.tensor(input, [1, this.inputLayerSize]);

            return this.weights.reduce((layer, weights, index) => {
                const fn = this.layers[index].fn;
                const result = layer.matMul(weights);

                return result[fn]()
                    .sub(tf.scalar(0.5));
            }, inputLayer);
        });
    }

    static get MUTATION_PROBABILITY() {
        return 0.05;
    }

    static fromParents(a, b) {
        const weightsA = a.getWeights();
        const weightsB = b.getWeights();
        const weightsC = new Float32Array(weightsA.length).fill()
            .map(_ => Math.random() * 2 - 1);

        const weights = new Array(weightsA.length).fill()
            .map((_, index) => {
                const a = weightsA[index];
                const b = weightsB[index];

                return new Float32Array(a.length).fill()
                    .map((_, weightIndex) => {
                        if (Math.random() < NeuralNetwork.MUTATION_PROBABILITY) {
                            return Math.random() * 2 - 1;
                        }

                        return Math.random() < 0.5
                            ? a[weightIndex]
                            : b[weightIndex];
                    });
            })
            .map((arr, index) => tf.tensor(arr, a.weights[index].shape));

        return new NeuralNetwork(weights, ...a.layers);
    }
}

class NeuralNetworkLayer {
    constructor(size, fn = 'sigmoid') {
        this.fn = fn;
        this.size = size;
    }
}

class Obstacle {
    constructor(gapSize) {
        this.gapSize = gapSize;
        this.gapSizeHalf = 0.5 * gapSize;
        this.position = new Vector2();
    }

    render(context) {
        const { width } = context.canvas;

        context.save();
        context.beginPath();

        context.moveTo(0, this.position.y);
        context.lineTo(this.position.x - this.gapSizeHalf, this.position.y);
        context.moveTo(this.position.x + this.gapSizeHalf, this.position.y);
        context.lineTo(width, this.position.y);

        context.lineWidth = Agent.SIZE;
        context.strokeStyle = '#444f56';
        context.stroke();
        context.restore();
    }

    overlaps(context, rectangle) {
        const { width } = context.canvas;

        const a = new Rectangle(
            new Vector2(0, this.position.y),
            new Vector2(this.position.x - this.gapSizeHalf, this.position.y),
        );
        const b = new Rectangle(
            new Vector2(this.position.x + this.gapSizeHalf, this.position.y),
            new Vector2(width, this.position.y),
        );

        return (
            Rectangle.overlap(rectangle, a) ||
            Rectangle.overlap(rectangle, b)
        );
    }
}

class Population {
    constructor(size) {
        this.agents = new Array(size).fill().map(_ => new Agent());
        this.generation = 0;
        this.size = size;
    }

    get isAlive() {
        return this.agents.some(a => a.isAlive);
    }

    dispose() {
        this.agents.forEach(a => a.dispose());
    }

    next() {
        const agents = this.agents;
        const parents = this.agents
            .sort((a, b) => b.score < a.score ? -1 : 1)
            .slice(0, 2);

        this.agents = this.agents.map(() => Agent.fromParents(...parents));

        agents.forEach(a => a.dispose());

        ++this.generation;
    }

    setAgentPosition(position) {
        this.agents.forEach((agent) => {
            agent.position.copy(position);
            agent.updateBoundingBox();
        });
    }
}

class Rectangle {
    constructor(v1 = new Vector2, v2 = new Vector2) {
        this._left = Math.min(v1.x, v2.x);
        this._right = Math.max(v1.x, v2.x);
        this._top = Math.min(v1.y, v2.y);
        this._bottom = Math.max(v1.y, v2.y);

        this.updateSize();
    }

    get bottom() {
        return this._bottom;
    }

    set bottom(value) {
        this._bottom = value;
        this.updateSize();
    }

    get left() {
        return this._left;
    }

    set left(value) {
        this._left = value;
        this.updateSize();
    }

    get right() {
        return this._right;
    }

    set right(value) {
        this._right = value;
        this.updateSize();
    }

    get top() {
        return this._top;
    }

    set top(value) {
        this._top = value;
        this.updateSize();
    }

    updateSize() {
        this.height = this._bottom - this._top;
        this.width = this._right - this._left;
    }

    static overlap(a, b) {
        if (
            a.left > b.right || b.left > a.right ||
            a.bottom < b.top || b.bottom < a.top
        ) return false;

        return true;
    }
}

class Vector2 {
    constructor(x = 0, y = 0) {
        this.x = x;
        this.y = y;
    }

    addScalar(s) {
        this.x += s;
        this.y += s;
        return this;
    }

    clone() {
        return new Vector2(this.x, this.y);
    }

    copy(v) {
        this.x = v.x;
        this.y = v.y;
        return this;
    }

    subtractScalar(s) {
        this.x -= s;
        this.y -= s;
        return this;
    }
}

const animate = (fn) => {
    let frame = 0;

    const reset = () => (frame = 0);
    const update = (time) => {
        requestAnimationFrame(update);
        fn(time, frame++, reset);
    };

    update(performance.now());
};

const context = document.getElementById('canvas').getContext('2d');
context.canvas.height = 512;
context.canvas.width = 512;

const elementParamAgentsAlive = document.getElementById('param-agents-alive');
const elementParamGeneration = document.getElementById('param-generation');
const elementParamHighscore = document.getElementById('param-highscore');

let highscore = 0;

const agentPositionOriginal = new Vector2(
    0.5 * context.canvas.width,
    context.canvas.height - 2 * Agent.SIZE
);

const obstacle = new Obstacle(8 * Agent.SIZE);
obstacle.position.x = context.canvas.width * Math.random();
let isUnloaded = false;

const population = new Population(8);
population.setAgentPosition(agentPositionOriginal);

animate((time, frame, reset) => {
    if (isUnloaded) return;

    if (!population.isAlive) {
        population.next();
        population.setAgentPosition(agentPositionOriginal);
        reset();
        return;
    }

    const { height, width } = context.canvas;
    const obstacleFrameLoop = (frame % 120) / 120;

    context.clearRect(0, 0, width, height);

    if (obstacleFrameLoop === 0) {
        obstacle.position.x = MathUtils.lerp(
            2 * Agent.SIZE,
            width - 2 * Agent.SIZE,
            Math.random()
        );
    }

    obstacle.position.y = height * obstacleFrameLoop;
    obstacle.render(context);

    population.agents.forEach((agent) => {
        if (agent.isAlive) {
            agent.update(context, obstacle.position.x);
            agent.score += (512 - Math.abs(agent.position.x - obstacle.position.x)) / 512;
        }

        if (obstacle.overlaps(context, agent.boundingBox)) {
            agent.kill();
        }

        agent.render(context);
    });

    highscore = Math.max(highscore, population.agents.reduce((highscore, a) => Math.max(highscore, a.score), 0));

    elementParamAgentsAlive.textContent = population.agents.filter(a => a.isAlive).length;
    elementParamGeneration.textContent = population.generation;
    elementParamHighscore.textContent = highscore.toFixed(2);
});

window.addEventListener('beforeunload', () => {
    population.dispose();
    isUnloaded = true;
});
</script>

<div class="container"><br>    <h1>Neuro-evolution</h1><br>    <p>Witness agents (depicted red) learn to pass the gaps in the walls.</p><br><br>    <canvas id="canvas"></canvas><br><br>    <dl><br>        <div><br>            <dt>Generation</dt><br>            <dd id="param-generation">0</dd><br>        </div><br>        <div><br>            <dt>Highscore</dt><br>            <dd id="param-highscore">0</dd><br>        </div><br>        <div><br>            <dt>Agents (alive)</dt><br>            <dd id="param-agents-alive">0</dd><br>        </div><br>    </dl><br><br>    <ol><br>        <li>Generate a population of agents with random neural networks</li><br>        <li>The population of agents spawn</li><br>        <li><br>            Agents try to move through the gaps<br>            <ol><br>                <li>After all agents are dead (depicted grey), pick out the top two</li><br>                <li>Generate a new population by cross-breeding the top two, with a small probability of mutation</li><br>                <li>Go to step 2</li><br>            </ol><br>        </li><br>    </ol><br></div>

<p>#<strong>AI</strong> #<strong>AIFirst</strong> #<strong>MontrealAI</strong> #<strong>MontrealArtificialIntelligence</strong></p>

    
    </div>
    
    
</article>


<div class="sharebox">
    
<div class="addthis_inline_share_toolbox"></div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5b39181e49b87264"></script>

</div>



<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<script>
    var disqus_config = function () {
        this.page.url = 'https://montrealai.github.io/web-ai/index.html';
        this.page.identifier = 'web-ai/index.html';
        
        this.language = 'en';
        
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'montrealai' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2018 Montréal.AI&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="Twitter" href="https://twitter.com/Montreal_AI">
                    
                    Twitter
                    
                </a>
                
                    
                <a class="column is-narrow has-text-black" title="Facebook" href="https://www.facebook.com/MontrealAI/">
                    
                    Facebook
                    
                </a>
                
                    
                <a class="column is-narrow has-text-black" title="LinkedIn" href="https://www.linkedin.com/in/montrealai/">
                    
                    LinkedIn
                    
                </a>
                
                    
                <a class="column is-narrow has-text-black" title="Français" href="http://intelligenceartificiellemontreal.com/">
                    
                    Français
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {matchFontHeight: false},
        SVG: {matchFontHeight: false},
        CommonHTML: {matchFontHeight: false}
    });
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    

    


<script src="/MontrealAI.github.io/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/MontrealAI.github.io/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/MontrealAI.github.io/js/insight.js"></script>
    
</body>
</html>